$((function(){"use strict";function t(e){$(".dark-mode i").attr("class","dark"===e?"bi-brightness-high":"bi-moon")}new PerfectScrollbar(".notify-list"),new PerfectScrollbar(".search-content"),"true"===localStorage.getItem("sidebar-toggled")&&($("body").addClass("toggled"),$(".sidebar-wrapper").hover((function(){$("body").addClass("sidebar-hovered")}),(function(){$("body").removeClass("sidebar-hovered")}))),$(".btn-toggle").click((function(){$("body").hasClass("toggled")?($("body").removeClass("toggled"),$(".sidebar-wrapper").unbind("hover"),localStorage.setItem("sidebar-toggled",!1)):($("body").addClass("toggled"),$(".sidebar-wrapper").hover((function(){$("body").addClass("sidebar-hovered")}),(function(){$("body").removeClass("sidebar-hovered")})),localStorage.setItem("sidebar-toggled",!0))})),$((function(){$("#sidenav").metisMenu()})),$(".sidebar-close").on("click",(function(){$("body").removeClass("toggled"),localStorage.setItem("sidebar-toggled",!1)})),t(localStorage.getItem("theme")||"light"),$(".dark-mode i").click((function(){$(this).attr("class",(function(){return $(this).hasClass("bi-moon")?"bi-brightness-high":"bi-moon"}))})),$(".dark-mode").click((function(){var e="dark"===$("html").attr("data-bs-theme")?"light":"dark";$("html").attr("data-bs-theme",e),localStorage.setItem("theme",e),t(e)})),$("#LightTheme").on("click",(function(){$("html").attr("data-bs-theme","light"),localStorage.setItem("theme","light")})),$("#DarkTheme").on("click",(function(){$("html").attr("data-bs-theme","dark"),localStorage.setItem("theme","dark")})),$("#SemiDarkTheme").on("click",(function(){$("html").attr("data-bs-theme","semi-dark"),localStorage.setItem("theme","semi-dark")})),$("#BoderedTheme").on("click",(function(){$("html").attr("data-bs-theme","bodered-theme"),localStorage.setItem("theme","bodered-theme")})),$(".search-control").click((function(){$(".search-popup").addClass("d-block"),$(".search-close").addClass("d-block")})),$(".mobile-search-btn").click((function(){$(".search-popup").addClass("d-block")})),$((function(){for(var e=window.location,t=$(".metismenu li a").filter((function(){return this.href==e})).addClass("").parent().addClass("mm-active");t.is("li");)t=t.parent("").addClass("mm-show").parent("").addClass("mm-active")})),$("div.modal").on("select2:open",(()=>{document.querySelector(".select2-search__field").focus()})),document.addEventListener("shown.bs.modal",(function(e){(e=e.target.querySelector(".modal-body"))&&new PerfectScrollbar(e)}))})),document.querySelectorAll("form").forEach((form=>{form.addEventListener("submit",(function(event){const button=form.querySelector(".cw-btn");button&&(button.setAttribute("data-loading","true"),button.disabled=!0,setTimeout((()=>form.submit()),10))})),form.querySelectorAll(".cw-btn").forEach((button=>{button.addEventListener("click",(function(e){form.checkValidity()||(e.preventDefault(),e.stopPropagation(),form.classList.add("was-validated"))}))}))})),$(document).ready((function(){const $searchInput=$(".search-control"),$mobileSearchInput=$(".mobile-search-control"),$searchPopup=$(".search-popup"),$keywordsWrapper=$(".kewords-wrapper"),$searchList=$(".search-list"),$notifyList=$(".notify-list"),$badgeNotify=$(".badge-notify");let typingTimer;let recentUrlMap={},currentPage=1,loading=!1,hasMorePages=!0;function performSearch(query){const url=linksURL+"?query="+encodeURIComponent(query);$.getJSON(url,(function(data){data.results.forEach((result=>{result.url&&result.title&&(recentUrlMap[result.title.toLowerCase()]=result.url)})),$keywordsWrapper.html(data.recentSearches.map((search=>{const url=recentUrlMap[search.toLowerCase()];return url?`\n                    <a href="${url}" class="kewords">\n                        <span>${search}</span>\n                        <i class="bi-arrow-right fs-6"></i>\n                    </a>\n                `:`\n                    <a href="javascript:;" class="kewords" onclick="$('.search-control').val('${search}');performSearch('${search}')">\n                        <span>${search}</span>\n                        <i class="bi-search fs-6"></i>\n                    </a>\n                `})).join("")),0===data.results.length?$searchList.html('\n                    <div class="search-list-item">\n                        <p class="text-muted mb-0">No links found</p>\n                    </div>\n                '):$searchList.html(data.results.map((link=>`\n                    <div class="search-list-item">\n                        <h5 class="mb-0 search-list-title">\n                            <a href="${link.url}" class="text-decoration-none">\n                                ${link.title}\n                            </a>\n                        </h5>\n                    </div>\n                `)).join(""))}))}function fetchActivityLogs(page=1,append=!1){if(loading||!append&&!hasMorePages)return;loading=!0,1===page?$notifyList.html('\n                <div class="text-center p-4">\n                    <div class="spinner-border text-primary" role="status">\n                        <span class="visually-hidden">Loading...</span>\n                    </div>\n                    <p class="mb-0 mt-3">Loading activity logs...</p>\n                </div>\n            '):append&&$notifyList.append('\n                <div class="text-center p-2 loading-indicator">\n                    <div class="spinner-border spinner-border-sm text-primary" role="status"></div>\n                </div>\n            ');const url=activityURL+"?page="+encodeURIComponent(page)+"&perPage=5";$.getJSON(url).done((data=>{$(".loading-indicator").remove(),append||$notifyList.empty(),$badgeNotify.text(data.todayCount>99?"99+":data.todayCount).toggle(data.todayCount>0),data.activities.forEach((activity=>{const todayIndicator=activity.is_today?'<span class="badge bg-success rounded-pill ms-2">New</span>':"";$notifyList.append(`\n                        <a class="dropdown-item border-bottom py-2" href="javascript:;">\n                            <div class="d-flex align-items-center gap-3">\n                                <div class="">\n                                    <img src="${activity.causer_image}" class="rounded-circle" width="45" height="45" alt="">\n                                </div>\n                                <div class="flex-grow-1">\n                                    <h5 class="notify-title">${activity.description} ${todayIndicator}</h5>\n                                    <p class="mb-0 notify-desc">By ${activity.causer_name} ${activity.subject_type?"on "+activity.subject_type:""}</p>\n                                    <p class="mb-0 notify-time">${activity.time}</p>\n                                </div>\n                                <div class="notify-close position-absolute end-0 me-3">\n                                    <i class="bi-x-circle fs-6"></i>\n                                </div>\n                            </div>\n                        </a>\n                    `)})),0!==data.activities.length||append||$notifyList.html('\n                        <div class="text-center p-4">\n                            <i class="bi bi-bell-slash fs-2 text-muted"></i>\n                            <p class="mb-0 mt-2">No activity logs found</p>\n                        </div>\n                    '),hasMorePages=data.hasMorePages,currentPage=page,loading=!1})).fail((error=>{console.error("Error fetching activity logs:",error),loading=!1,$(".loading-indicator").remove(),append||$notifyList.html('\n                        <div class="text-center p-4">\n                            <i class="bi bi-exclamation-circle fs-2 text-danger"></i>\n                            <p class="mb-0 mt-2">Failed to load notifications</p>\n                        </div>\n                    ')}))}performSearch(""),$searchInput.on("keyup",(function(){clearTimeout(typingTimer),typingTimer=setTimeout((()=>performSearch($(this).val())),500)})),$mobileSearchInput.on("keyup",(function(){clearTimeout(typingTimer),typingTimer=setTimeout((()=>performSearch($(this).val())),500)})),$searchInput.on("focus",(()=>$searchPopup.show())),$(".search-close").on("click",(()=>$searchPopup.hide())),$(".mobile-search-close").on("click",(()=>$searchPopup.hide())),$(".dropdown-menu").on("click",(function(e){e.stopPropagation()})),$('a[onclick*="collapseMenuItems"]').on("click",(function(){$(this).find("i").toggleClass("rotate-180")})),fetchActivityLogs(),$notifyList.on("scroll",(function(){const $this=$(this);$this.scrollTop()+$this.innerHeight()>=$this[0].scrollHeight-50&&hasMorePages&&!loading&&fetchActivityLogs(currentPage+1,!0)})),$('a.nav-link[data-bs-toggle="dropdown"]').on("click",(function(){$(".dropdown-notify").hasClass("show")||(currentPage=1,hasMorePages=!0,fetchActivityLogs())})),$notifyList.on("click",".notify-close",(function(e){$(this).closest(".dropdown-item").remove()})),$(document).on("click",(function(e){const popup=$(".search-popup"),input=$(".admin-search"),searchBtn=$(".mobile-search-btn");popup.is(e.target)||0!==popup.has(e.target).length||searchBtn.is(e.target)||0!==searchBtn.has(e.target).length||input.is(e.target)||0!==input.has(e.target).length||(popup.removeClass("d-block"),popup[0].style.display="none")}))})),$(document).on("select2:open",(function(){setTimeout((function(){let searchField=document.querySelector(".select2-container--open .select2-search__field");searchField&&(searchField.focus(),searchField.placeholder="Search...")}),0)})),window.addEventListener("error",(function(e){if(e.message.includes("Extension context invalidated")||e.message.includes("runtime.lastError"))return e.preventDefault(),!0}));