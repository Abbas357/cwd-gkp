function showMessage(message,type="success",options={}){Swal.fire({position:"top-end",icon:type,title:message,showConfirmButton:options.showConfirmButton||!1,timer:options.timer||3e3,...options})}async function confirmAction(text="You won't be able to revert this!",type="warning"){return await Swal.fire({title:"Are you sure?",text:text,icon:type,showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Yes, do it!",cancelButtonText:"No, cancel"})}async function confirmWithInput({text:text="Please provide your input",inputValidator:inputValidator=null,inputType:inputType="text",inputPlaceholder:inputPlaceholder="",confirmButtonText:confirmButtonText="Submit",cancelButtonText:cancelButtonText="Cancel"}={}){const options={title:text,input:"textarea"===inputType?"textarea":inputType,inputPlaceholder:inputPlaceholder,showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:confirmButtonText,cancelButtonText:cancelButtonText};return inputValidator&&(options.inputValidator=inputValidator),await Swal.fire(options)}async function fetchRequest(url,method="GET",data={},successMessage="Operation successful",errorMessage="There was an error processing your request"){try{let headers={"X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').getAttribute("content"),Accept:"application/json"};data instanceof FormData||(headers["Content-Type"]="application/json");const options={method:method,headers:headers,body:null};"GET"!==method&&(options.body=data instanceof FormData?data:JSON.stringify(data));const response=await fetch(url,options);if(!response.ok){if(422===response.status){return handleValidationErrors((await response.json()).errors),!1}throw new Error(`HTTP error! Status: ${response.status}`)}const result=await response.json();return result.success?"GET"===method?result.data:(showMessage(result.success||successMessage),!0):(showMessage(result.error||errorMessage||"An unexpected error occurred","error"),!1)}catch(error){return showMessage(errorMessage||"There was an error processing your request","error"),!1}}function handleValidationErrors(errors){$(".form-error").remove(),setButtonLoading($('button[type="submit"]'),!1);for(const field in errors){const errorMessages=errors[field],input=$(`[name="${field}"]`);errorMessages.forEach((message=>{const errorElement=`<span class="form-error text-danger">${message}</span>`;input.after(errorElement)}))}}function initDataTable(selector,options={}){const exportButtons=[{extend:"copy",text:'<span class="symbol-container">\n                    <i class="bi-copy"></i>\n                    &nbsp; Copy\n                </span>',exportOptions:{columns:":visible:not(:last-child)"}},{extend:"csv",text:'<span class="symbol-container">\n                    <i class="bi-filetype-csv"></i>\n                    &nbsp; CSV\n                </span>',exportOptions:{columns:":visible:not(:last-child)"}},{extend:"excel",text:'<span class="symbol-container">\n                    <i class="bi-file-spreadsheet"></i>\n                    &nbsp; Excel\n                </span>',exportOptions:{columns:":visible:not(:last-child)"}},{extend:"print",text:'<span class="symbol-container">\n                    <i class="bi-printer"></i>\n                    &nbsp; Print\n                </span>',autoPrint:!1,exportOptions:{columns:":visible:not(:last-child)"}}],defaultOptions={processing:!0,stateSave:!0,autoWidth:!0,serverSide:!0,colReorder:{columns:":not(:first-child, :last-child)"},ajax:{url:options.ajaxUrl||"",error(jqXHR,textStatus,errorThrown){$(selector).removeClass("card-loading"),"timeout"!==textStatus&&"abort"!==textStatus||$(selector).DataTable().ajax.reload()}},order:[[options.defaultOrderColumn||"created_at",options.defaultOrderDirection||"desc"]],columns:options.columns||[],language:{searchBuilder:{title:{0:"Conditions",_:"Conditions (%d)"},clearAll:"Clear All Filters",button:'<span class="symbol-container">\n                            <i class="bi-funnel"></i>\n                            &nbsp; Filter\n                        </span>'}},layout:{topStart:{buttons:[{extend:"collection",text:'<span class="symbol-container">\n                                <i class="bi-share"></i>\n                                &nbsp; Export\n                            </span>',autoClose:!0,buttons:exportButtons},{extend:"colvis",collectionLayout:"two-column",text:'<span class="symbol-container">\n                                <i class="bi-eye"></i>\n                                &nbsp; Columns\n                            </span>'},{extend:"searchBuilder",config:{depthLimit:3,preDefined:{criteria:[{origData:"id",data:"id"}]}}},{text:'<span class="symbol-container">\n                                <i class="bi-arrow-clockwise"></i>\n                                &nbsp; Reset\n                            </span>',action:function(e,dt,node,config){confirmAction("Resetting will clear all saved settings").then((res=>{res.isConfirmed&&(dt.state.clear(),localStorage.removeItem(selector.replace("#","")),window.location.reload())}))}},...options.customButton?[options.customButton]:[]]},top1Start:{pageLength:{menu:options.pageLengthMenu||[[5,10,25,50,100,500,-1],[5,10,25,50,100,500,"All"]]}},topEnd:{search:{placeholder:options.searchPlaceholder||"Type search here..."}}},columnDefs:options.columnDefs||[],preDrawCallback(){$(selector).addClass("card-loading")},drawCallback(){$(selector).removeClass("card-loading")}};$.fn.dataTable.ext.errMode="throw";const finalOptions=$.extend(!0,{},defaultOptions,options);return $(selector).DataTable(finalOptions)}function hashTabsNavigator(config){const{table:table,dataTableUrl:dataTableUrl,tabToHashMap:tabToHashMap,hashToParamsMap:hashToParamsMap,defaultHash:defaultHash}=config;function updateDataTableURL(params){let queryParams=function(params){if(!params)return"";const queryParams=Object.entries(params).filter((([key,value])=>void 0!==value)).flatMap((([key,value])=>Array.isArray(value)?value.map((val=>`${encodeURIComponent(key)}[]=${encodeURIComponent(val)}`)):`${encodeURIComponent(key)}=${encodeURIComponent(value)}`)).join("&");return queryParams?"?"+queryParams:""}(params),tableFullUrl=dataTableUrl+queryParams;table.ajax.url(tableFullUrl).load()}$(".nav-tabs-table a").on("click",(function(){let href=$(this).attr("href");window.location.hash=href}));let initialTab=window.location.hash||defaultHash;var tabId;updateDataTableURL(hashToParamsMap[initialTab]||{}),tabId=initialTab,$('.nav-tabs-table a[href="'+tabId+'"]').tab("show"),$(".tab-pane-table").removeClass("active show"),$(tabId).addClass("active show"),Object.keys(tabToHashMap).forEach((function(tabSelector){$(tabSelector).on("click",(function(){let hash=tabToHashMap[tabSelector];updateDataTableURL(hashToParamsMap[hash]||{})}))}))}function setButtonLoading(buttonSelector,isLoading=!0,loadingText="Please wait..."){if(!buttonSelector)return;const button=$(buttonSelector);if(!button.length)return;const formElement=button.closest("form"),originalText=button.val()||button.html();isLoading?(formElement.length&&formElement.addClass("disabled-form"),button.data("original-text",originalText),document.documentElement.classList.add("card-loading"),button.is("button")?button.html(`\n                <span class="spinner-border spinner-border-sm" aria-hidden="true"></span>\n                <span role="status">${loadingText}</span>\n            `):button.is("input")&&button.val(loadingText),button.prop("disabled",!0)):(formElement.length&&formElement.removeClass("disabled-form"),document.documentElement.classList.remove("card-loading"),button.is("button")?button.html(button.data("original-text")):button.is("input")&&button.val(button.data("original-text")),button.prop("disabled",!1))}function resizableTable(selector,options={}){const finalOptions=Object.assign({},{liveDrag:!0,resizeMode:"overflow",postbackSafe:!0,useLocalStorage:!0,gripInnerHtml:"<div class='grip'></div>",draggingClass:"dragging"},options);$(selector).colResizable(finalOptions)}function uniqId(amount){const chars="abcdefghijklmnopqrstuvwxyz0123456789";let uniqueID="";for(let i=0;i<amount;i++){uniqueID+=chars[Math.floor(36*Math.random())]}return uniqueID}function imageCropper(options){var defaults={fileInput:"#image",inputLabelPreview:"#image-label-preview",aspectRatio:1,viewMode:2,imageType:"image/jpeg",quality:.7,onComplete:null};options=$.extend({},defaults,options);var uniqueId=uniqId(6),modalId=`#crop-modal-${uniqueId}`,cropBoxImageId=`#cropbox-image-${uniqueId}`,cropButtonId=`#apply-crop-${uniqueId}`,aspectRatioSelectId="#aspect-ratio-select",actionsContainerId=`#action-buttons-${uniqueId}`;$("body").append(generateModalHtml(uniqueId));var $fileInput=$(options.fileInput),$inputLabelPreview=$(options.inputLabelPreview),$cropBoxImage=$(cropBoxImageId),$cropModal=$(modalId),$aspectRatioSelect=$(aspectRatioSelectId),$cropButton=$(cropButtonId),$actionsContainer=$(actionsContainerId),cropper;function loadActionButtons($container){var buttonsHTML='\n        <select id="aspect-ratio-select" class="select-aspect-ratio form-control">\n            <option value="">Choose Size</option>\n            <option value="1 / 1">1:1 (Square)</option>\n            <option value="16 / 9">16:9 (Widescreen)</option>\n            <option value="9 / 16">9:16 (Vertical)</option>\n            <option value="21 / 9">21:9 (Ultra-wide)</option>\n            <option value="4 / 3">4:3 (Old TV)</option>\n            <option value="3 / 2">3:2 (DSLR)</option>\n            <option value="1 / 1.294">1:1.294 (Letter)</option>\n            <option value="1 / 1.6471">1:1.6471 (Legal)</option>\n            <option value="NaN">Free (Whatever you want)</option>\n        </select>\n        <button type="button" class="btn-mode-move btn btn-light btn-sm" data-method="setDragMode" data-option="move" title="Move">\n            <span class="docs-tooltip" data-toggle="tooltip" title="cropper.setDragMode(&quot;move&quot;)">\n                <span class="text-xs bi-arrows-move"></span>\n            </span>\n        </button>\n        <button type="button" class="btn-mode-crop btn btn-light btn-sm" data-method="setDragMode" data-option="crop" title="Crop">\n            <span class="docs-tooltip" data-toggle="tooltip" title="cropper.setDragMode(&quot;crop&quot;)">\n                <span class="text-xs bi-crop"></span>\n            </span>\n        </button>\n        <button type="button" class="btn-zoom-in btn btn-light btn-sm" data-method="zoom" data-option="0.1" title="Zoom In">\n            <span class="docs-tooltip" data-toggle="tooltip" title="cropper.zoom(0.1)">\n                <i class="bi bi-zoom-in"></i>\n            </span>\n        </button>\n        <button type="button" class="btn-zoom-out btn btn-light btn-sm" data-method="zoom" data-option="-0.1" title="Zoom Out">\n            <span class="docs-tooltip" data-toggle="tooltip" title="cropper.zoom(-0.1)">\n                <i class="bi bi-zoom-out"></i>\n            </span>\n        </button>\n        <button type="button" class="btn-arrow-left btn btn-light btn-sm" data-method="move" data-option="-10" data-second-option="0" title="Move Left">\n            <span class="docs-tooltip" data-toggle="tooltip" title="cropper.move(-10, 0)">\n                <span class="text-xs bi-arrow-left"></span>\n            </span>\n        </button>\n        <button type="button" class="btn-arrow-right btn btn-light btn-sm" data-method="move" data-option="10" data-second-option="0" title="Move Right">\n            <span class="docs-tooltip" data-toggle="tooltip" title="cropper.move(10, 0)">\n                <span class="text-xs bi-arrow-right"></span>\n            </span>\n        </button>\n        <button type="button" class="btn-arrow-up btn btn-light btn-sm" data-method="move" data-option="0" data-second-option="-10" title="Move Up">\n            <span class="docs-tooltip" data-toggle="tooltip" title="cropper.move(0, -10)">\n                <span class="text-xs bi-arrow-up"></span>\n            </span>\n        </button>\n        <button type="button" class="btn-arrow-down btn btn-light btn-sm" data-method="move" data-option="0" data-second-option="10" title="Move Down">\n            <span class="docs-tooltip" data-toggle="tooltip" title="cropper.move(0, 10)">\n                <span class="text-xs bi-arrow-down"></span>\n            </span>\n        </button>\n        <button type="button" class="btn-flip-vr btn btn-light btn-sm" data-method="scaleX" data-option="-1" title="Flip Horizontal">\n            <span class="docs-tooltip" data-toggle="tooltip" title="cropper.scaleX(-1)">\n                <i class="bi-vr"></i>\n            </span>\n        </button>\n        <button type="button" class="btn-flip-hr btn btn-light btn-sm" data-method="scaleY" data-option="-1" title="Flip Vertical">\n            <span class="docs-tooltip" data-toggle="tooltip" title="cropper.scaleY(-1)">\n                <i class="bi-hr"></i>\n            </span>\n        </button>\n        <button type="button" class="btn-add-crop btn btn-light btn-sm" data-method="crop" title="Crop">\n            <span class="docs-tooltip" data-toggle="tooltip" title="cropper.crop()">\n                <span class="text-xs bi-check-lg"></span>\n            </span>\n        </button>\n        <button type="button" class="btn-remove-crop btn btn-light btn-sm" data-method="clear" title="Clear">\n            <span class="docs-tooltip" data-toggle="tooltip" title="cropper.clear()">\n                <i class="bi-x"></i>\n            </span>\n        </button>\n        <button type="button" class="btn-lock btn btn-light btn-sm" data-method="disable" title="Disable">\n            <span class="docs-tooltip" data-toggle="tooltip" title="cropper.disable()">\n                <span class="text-xs bi-lock"></span>\n            </span>\n        </button>\n        <button type="button" class="btn-unlock btn btn-light btn-sm" data-method="enable" title="Enable">\n            <span class="docs-tooltip" data-toggle="tooltip" title="cropper.enable()">\n                <span class="text-xs bi-unlock"></span>\n            </span>\n        </button>\n    ';$container.html(buttonsHTML),$container.find("#aspect-ratio-select").on("change",(function(){var aspectRatio=eval($(this).val());cropper&&cropper.setAspectRatio(aspectRatio)}))}function generateModalHtml(uniqueId){return`\n        <div class="modal modal fade" id="crop-modal-${uniqueId}" tabindex="-1" role="dialog" aria-labelledby="modalLabel" aria-hidden="true">\n            <div class="modal-dialog" role="document">\n                <div class="modal-content">\n                    <div class="modal-header">\n                        <h5 class="modal-title" id="modalLabel">Crop the image</h5>\n                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>\n                    </div>\n                    <div class="modal-body">\n                        <div class="img-container">\n                            <img id="cropbox-image-${uniqueId}" style="display:block; max-height:300px; max-width:100%">\n                        </div>\n                        <div id="action-buttons-${uniqueId}"></div>\n                    </div>\n                    <div class="modal-footer">\n                        <button type="button" class="btn btn-outline-secondary btn-sm" data-bs-dismiss="modal">Cancel</button>\n                        <button type="button" class="btn btn-primary btn-sm" id="apply-crop-${uniqueId}">Crop</button>\n                    </div>\n                </div>\n            </div>\n        </div>\n        `}$fileInput.on("change",(function(e){var files=e.target.files;if(0!==files.length&&files[0].type.startsWith("image/")){var reader,file,done=function(url){$cropBoxImage.attr("src",url),$cropModal.modal({backdrop:"static",keyboard:!1}),$cropModal.modal("show")};files&&files.length>0&&(file=files[0],URL?done(URL.createObjectURL(file)):FileReader&&((reader=new FileReader).onload=function(e){done(reader.result)},reader.readAsDataURL(file))),$cropButton.data("input",this),$cropButton.data("preview",$inputLabelPreview)}else options.onComplete(files[0],this)})),$cropModal.on("click",(function(e){$(e.target).is($cropModal)&&($cropModal.addClass("shake"),setTimeout((function(){$cropModal.removeClass("shake")}),500))})),$cropModal.on("shown.bs.modal",(function(){var selectedAspectRatio=parseFloat($aspectRatioSelect.val())||options.aspectRatio;cropper=new Cropper($cropBoxImage[0],{aspectRatio:selectedAspectRatio,viewMode:options.viewMode,ready:function(){$actionsContainer&&loadActionButtons($actionsContainer)}})})).on("hidden.bs.modal",(function(){cropper&&(cropper.destroy(),cropper=null)})),$cropButton.on("click",(function(){var canvas;if($cropModal.modal("hide"),cropper){canvas=cropper.getCroppedCanvas(),$(this).data("preview").attr("src",canvas.toDataURL(options.imageType,options.quality));var $fileInput=$(this).data("input");canvas.toBlob((function(blob){var file=new File([blob],`cropped-${uniqId(6)}.jpg`,{type:options.imageType});"function"==typeof options.onComplete&&options.onComplete(file,$fileInput);var dataTransfer=new DataTransfer;dataTransfer.items.add(file),$fileInput.files=dataTransfer.files}),options.imageType,options.quality)}})),$actionsContainer.on("click",(function(event){var target=event.target;if(cropper){for(;target!==this&&!target.getAttribute("data-method");)target=target.parentNode;if(!(target===this||target.disabled||target.className.indexOf("disabled")>-1)){var data={method:target.getAttribute("data-method"),option:target.getAttribute("data-option"),secondOption:target.getAttribute("data-second-option")};data.method&&(cropper[data.method](data.option,data.secondOption),"scaleX"!==data.method&&"scaleY"!==data.method||target.setAttribute("data-option",-data.option))}}}))}function pushStateModal({title:title="Title",fetchUrl:fetchUrl,btnSelector:btnSelector,loadingSpinner:loadingSpinner="loading-spinner",actionButtonName:actionButtonName,modalSize:modalSize="md",modalType:modalType,includeForm:includeForm=!1,formAction:formAction,modalHeight:modalHeight=null,hash:hash=!0,tableToRefresh:tableToRefresh=null}){return new Promise((resolve=>{const calcModalType=modalType??btnSelector.replace(/^[.#]/,"").split("-")[0],modalId=`modal-${calcModalType}`,modalContentClass=`detail-${calcModalType}`,heightStyle="auto"===modalHeight?"max-height: 75vh; height: auto;":`max-height: 75vh; height: ${modalHeight};`,actionBtnId=actionButtonName&&actionButtonName.replace(/\s+/g,"-").toLowerCase()+"-"+calcModalType,modalTemplate=`\n        <div class="modal fade" id="${modalId}" tabindex="-1" aria-hidden="true">\n            <div class="modal-dialog modal-${modalSize} modal-dialog-centered modal-dialog-scrollable">\n                <div class="modal-content">\n                    <div class="modal-header">\n                        <h5 class="modal-title">${title}</h5>\n                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>\n                    </div>\n                    ${includeForm?`<form id="form-${calcModalType}" method="POST" enctype="multipart/form-data">`:""}\n                    <div class="modal-body" style="${heightStyle}">\n                        <div class="${loadingSpinner} text-center mt-2">\n                            <div class="spinner-border" role="status">\n                                <span class="visually-hidden">Loading...</span>\n                            </div>\n                        </div>\n                        <div class="${modalContentClass} p-1"></div>\n                    </div>\n                    <div class="modal-footer">\n                        <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal" aria-label="Close">Cancel</button>\n                        ${actionButtonName?`<button type="submit" id="${actionBtnId}" class="btn btn-primary px-3">${actionButtonName}</button>`:""}    \n                    </div>\n                    ${includeForm?"</form>":""}\n                </div>\n            </div>\n        </div>`;async function openModal(recordId){const url=fetchUrl.replace(":id",recordId);includeForm&&$(`#form-${calcModalType}`).attr("action",formAction.replace(":id",recordId)),$(`#${modalId}`).modal("show"),$(`#${modalId} .${loadingSpinner}`).show(),$(`#${modalId} .${modalContentClass}`).hide();const result=(await fetchRequest(url)).result;result?($(`#${modalId} .modal-title`).text(title),$(`#${modalId} .${modalContentClass}`).html(result)):($(`#${modalId} .modal-title`).text("Error"),$(`#${modalId} .${modalContentClass}`).html('<p class="pb-0 pt-3 p-4">Unable to load content.</p>')),$(`#${modalId} .${loadingSpinner}`).hide(),$(`#${modalId} .${modalContentClass}`).show()}function openModalFromUrl(){if(!hash)return;const urlParams=new URLSearchParams(window.location.search),recordId=urlParams.get("id"),type=urlParams.get("type");recordId&&type===calcModalType&&openModal(recordId)}if($(`#${modalId}`).length||$("body").append(modalTemplate),$(document).on("click",btnSelector,(function(){const recordId=$(this).data("id");if(hash){const newUrl=`${new URL(window.location).pathname}?id=${recordId}&type=${calcModalType}${window.location.hash}`;history.pushState(null,null,newUrl)}openModal(recordId)})),hash&&($(window).on("popstate",(function(){openModalFromUrl()})),$(`#${modalId}`).on("hidden.bs.modal",(function(){const currentUrl=new URL(window.location);currentUrl.searchParams.delete("id"),currentUrl.searchParams.delete("type");const newUrl=`${currentUrl.pathname}${currentUrl.search}${window.location.hash}`;history.pushState(null,null,newUrl)}))),openModalFromUrl(),includeForm){const modalElement=$(`#${modalId}`),submitBtn=modalElement.find('button[type="submit"]');modalElement.find("form").on("submit",(async function(e){e.preventDefault();const form=this;if(form.isSubmitting)return!1;form.isSubmitting=!0;const formData=new FormData(form),url=$(this).attr("action");setButtonLoading(submitBtn,!0);try{await fetchRequest(url,"POST",formData)&&(setButtonLoading(submitBtn,!1),modalElement.modal("hide"),tableToRefresh&&tableToRefresh.ajax.reload())}catch(error){console.error("Error submitting form: ",error)}finally{form.isSubmitting=!1,setButtonLoading(submitBtn,!1),submitBtn.prop("disabled",!1),submitBtn.text(actionButtonName)}}))}modalId.length&&resolve(modalId)}))}function formWizardModal({title:title="Title",fetchUrl:fetchUrl,btnSelector:btnSelector,loadingSpinner:loadingSpinner="loading-spinner",actionButtonName:actionButtonName="Submit",modalSize:modalSize="lg",formAction:formAction,modalHeight:modalHeight="auto",wizardSteps:wizardSteps=[],onModalLoaded:onModalLoaded=null,onStepShown:onStepShown=null,formSubmitted:formSubmitted=null}){return new Promise((resolve=>{const modalType=btnSelector.replace(/^[.#]/,"").split("-")[0];let modalId=`modal-${modalType}`;const modalContentClass=`detail-${modalType}`,heightStyle="auto"===modalHeight?"max-height: 75vh; height: auto;":`max-height: 75vh; height: ${modalHeight};`,modalTemplate=`\n        <div class="modal fade" id="${modalId}" tabindex="-1" aria-hidden="true">\n            <div class="modal-dialog modal-${modalSize} modal-dialog-centered modal-dialog-scrollable">\n                <div class="modal-content" id="cw-wizard">\n                    <div class="modal-header">\n                        <h5 class="modal-title">${title}</h5>\n                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>\n                    </div>\n                    <div class="cw-wizard-navigation">\n                        <ul class="nav nav-pills nav-justified cw-wizard-steps">\n                            ${wizardSteps.map(((step,index)=>`\n                                <li class="nav-item cw-wizard-step-item">\n                                    <button type="button" class="nav-link ${0===index?"active":"disabled"}" data-step="${index}">\n                                        <div class="cw-wizard-step-circle">\n                                            <span class="cw-wizard-step-number">${index+1}</span>\n                                            <span class="cw-wizard-step-check"><i class="bi bi-check-lg"></i></span>\n                                        </div>\n                                        <span class="cw-wizard-step-text">${step.title}</span>\n                                        ${index<wizardSteps.length-1?'<span class="cw-wizard-step-connector"></span>':""}\n                                    </button>\n                                </li>\n                            `)).join("")}\n                        </ul>\n                    </div>\n                    <div class="cw-wizard-step-indicator">\n                        <div class="progress progress-container">\n                            <div class="progress-bar bg-success custom-progress-bar" \n                                role="progressbar" \n                                style="width: ${100/wizardSteps.length}%">\n                                <div class="progress-shine"></div>\n                            </div>\n                        </div>\n                    </div>\n                    <div id="error-indicator"></div>\n                    <form id="form-${modalType}" method="POST" enctype="multipart/form-data">\n                        <div class="modal-body" style="${heightStyle}">\n                            <div class="${loadingSpinner} text-center mt-2">\n                                <div class="spinner-border" role="status">\n                                    <span class="visually-hidden">Loading...</span>\n                                </div>\n                            </div>\n                            <div class="${modalContentClass} p-1"></div>\n                        </div>\n                        <div class="modal-footer">\n                            <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal" aria-label="Close">Cancel</button>\n                            <button type="button" class="btn btn-outline-primary cw-wizard-prev me-2" style="display: none;">Previous</button>\n                            <button type="button" class="btn btn-primary cw-wizard-next" disabled>Next</button>\n                            <button type="button" class="btn btn-success cw-wizard-submit" style="display: none;" disabled>${actionButtonName}</button>\n                        </div>\n                    </form>\n                </div>\n            </div>\n        </div>`,existingModal=$(`#${modalId}`);if(existingModal.length){try{const modalInstance=bootstrap.Modal.getInstance(existingModal[0]);modalInstance&&modalInstance.dispose()}catch(e){console.error("Error disposing existing modal:",e)}existingModal.off().removeData().remove()}async function openModal(recordId){const url=fetchUrl.replace(":id",recordId);$(`#form-${modalType}`).attr("action",formAction.replace(":id",recordId)),$(`#${modalId}`).modal("show"),$(`#${modalId} .${loadingSpinner}`).show(),$(`#${modalId} .${modalContentClass}`).hide();const result=(await fetchRequest(url)).result;result?($(`#${modalId} .modal-title`).text(title),$(`#${modalId} .${modalContentClass}`).html(result),function(modalId,steps){const $modal=$(`#${modalId}`),$content=$modal.find(`.${modalContentClass}`);let currentStep=0,completedSteps=new Set;function isFieldCompleted(field){const $field=$(field);if($field.is("select"))return null!==$field.val()&&""!==$field.val();if($field.is('input[type="checkbox"], input[type="radio"]')){const name=$field.attr("name");return $modal.find(`input[name="${name}"]:checked`).length>0}return $field.is('input[type="file"]')?$field.get(0).files.length>0||!$field.prop("required"):""!==$field.val()}function isStepCompleted(stepIndex){const $requiredFields=$modal.find(`.cw-wizard-step[data-step="${stepIndex}"]`).find("[required]");if(0===$requiredFields.length)return!0;let isCompleted=!0;return $requiredFields.each((function(){if(!isFieldCompleted(this))return isCompleted=!1,!1})),isCompleted}function canAccessStep(targetStepIndex){let allStepsCompleted=!0;for(let i=0;i<steps.length;i++)if(!isStepCompleted(i)){allStepsCompleted=!1;break}return!!allStepsCompleted||(0===targetStepIndex||(targetStepIndex===currentStep||(targetStepIndex===currentStep-1||!(targetStepIndex!==currentStep+1||!isStepCompleted(currentStep)))))}function updateWizardState(){const currentStepCompleted=isStepCompleted(currentStep);currentStepCompleted?completedSteps.add(currentStep):completedSteps.delete(currentStep);let allStepsCompleted=!0;for(let i=0;i<steps.length;i++)if(!isStepCompleted(i)){allStepsCompleted=!1;break}$modal.find(".cw-wizard-next").prop("disabled",!currentStepCompleted),$modal.find(".cw-wizard-submit").prop("disabled",!allStepsCompleted),$modal.find(".cw-wizard-steps .nav-link").each((function(){const stepIndex=parseInt($(this).data("step"));$(this).removeClass("active completed disabled cw-tab-alert"),stepIndex===currentStep?$(this).addClass("active"):completedSteps.has(stepIndex)?($(this).addClass("completed"),canAccessStep(stepIndex)||$(this).addClass("disabled")):canAccessStep(stepIndex)||$(this).addClass("disabled")})),updateProgressBar(),updateStepConnectors()}function highlightMissingFields(stepIndex){$modal.find(`.cw-wizard-step[data-step="${stepIndex}"]`).find("[required]").each((function(){isFieldCompleted(this)?$(this).removeClass("is-invalid"):($(this).addClass("is-invalid"),$(this).addClass("cw-field-shake"),setTimeout((()=>$(this).removeClass("cw-field-shake")),600))}))}function updateProgressBar(){const totalSteps=steps.length,completedCount=completedSteps.size,progress=Math.max((currentStep+1)/totalSteps*100,completedCount/totalSteps*100);$modal.find(".progress-bar").css("width",`${progress}%`).attr("aria-valuenow",progress)}function updateStepConnectors(){$modal.find(".cw-wizard-steps .nav-link").each((function(){const stepIndex=parseInt($(this).data("step")),$connector=$(this).find(".cw-wizard-step-connector");$connector.length&&completedSteps.has(stepIndex)?$connector.addClass("completed"):$connector.length&&$connector.removeClass("completed")}))}function attachFieldListeners(){$modal.find("input, select, textarea").on("input change blur",(function(){$(this).removeClass("is-invalid"),updateWizardState()}))}function organizeWizardSteps($content,steps){steps.forEach(((step,index)=>{const $stepContainer=$(`<div class="cw-wizard-step" data-step="${index}" style="display: none;"></div>`);if(step.fields&&step.fields.length)step.fields.forEach((fieldSelector=>{const $field=$content.find(fieldSelector).closest('.form-group, .col-md-12, .col-md-8, .col-md-6, .col-md-4, .col-md-3, [class*="col-"]');if($field.length)$stepContainer.append($field);else{const $directField=$content.find(fieldSelector);$directField.length&&$stepContainer.append($directField)}}));else if(step.selector){const $fields=$content.find(step.selector);$stepContainer.append($fields)}$content.append($stepContainer)}))}function showWizardStep(stepIndex){$modal.find(".cw-wizard-step").hide(),$modal.find(`.cw-wizard-step[data-step="${stepIndex}"]`).fadeIn(200),$modal.find(".cw-wizard-prev").toggle(stepIndex>0),$modal.find(".cw-wizard-next").toggle(stepIndex<steps.length-1),$modal.find(".cw-wizard-submit").toggle(stepIndex===steps.length-1);const currentStepTitle=steps[stepIndex].title;$modal.find(".modal-title").text(`${title} - ${currentStepTitle}`),adjustModalHeight(),"function"==typeof onStepShown&&onStepShown(stepIndex,steps[stepIndex])}organizeWizardSteps($content,steps),showWizardStep(currentStep),$modal.find(".cw-wizard-next").on("click",(function(){if(isStepCompleted(currentStep)){const nextStep=currentStep+1;nextStep<steps.length&&(completedSteps.add(currentStep),currentStep=nextStep,showWizardStep(currentStep),updateWizardState(),$modal.find(".modal-body").scrollTop(0),adjustModalHeight())}else highlightMissingFields(currentStep),$(this).addClass("cw-btn-shake"),setTimeout((()=>$(this).removeClass("cw-btn-shake")),500)})),$modal.find(".cw-wizard-prev").on("click",(function(){currentStep>0&&(currentStep--,showWizardStep(currentStep),updateWizardState(),$modal.find(".modal-body").scrollTop(0),adjustModalHeight())})),$modal.find(".cw-wizard-submit").on("click",(function(){let allStepsCompleted=!0,firstIncompleteStep=-1;for(let i=0;i<steps.length;i++)if(!isStepCompleted(i)){allStepsCompleted=!1,-1===firstIncompleteStep&&(firstIncompleteStep=i);const $tab=$modal.find(`.cw-wizard-steps .nav-link[data-step="${i}"]`);$tab.addClass("cw-tab-alert"),setTimeout((()=>$tab.removeClass("cw-tab-alert")),1500)}if(allStepsCompleted){const $btn=$(this);$btn.html('<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span> Submitting...'),$btn.prop("disabled",!0),$modal.find("form").submit()}else-1!==firstIncompleteStep&&(currentStep=firstIncompleteStep,showWizardStep(currentStep),updateWizardState(),highlightMissingFields(currentStep),$modal.find(".modal-body").scrollTop(0),adjustModalHeight()),$(this).addClass("cw-btn-shake"),setTimeout((()=>$(this).removeClass("cw-btn-shake")),500)})),$modal.find(".cw-wizard-steps .nav-link").on("click",(function(){const stepIndex=parseInt($(this).data("step"));canAccessStep(stepIndex)?(currentStep=stepIndex,showWizardStep(currentStep),updateWizardState(),$modal.find(".modal-body").scrollTop(0),adjustModalHeight()):($(this).addClass("cw-nav-link-shake"),setTimeout((()=>$(this).removeClass("cw-nav-link-shake")),500))})),attachFieldListeners(),updateWizardState()}(modalId,wizardSteps),adjustModalHeight(),"function"==typeof onModalLoaded&&onModalLoaded()):($(`#${modalId} .modal-title`).text("Error"),$(`#${modalId} .${modalContentClass}`).html('<p class="pb-0 pt-3 p-4">Unable to load content.</p>')),$(`#${modalId} .${loadingSpinner}`).hide(),$(`#${modalId} .${modalContentClass}`).show()}function adjustModalHeight(){$(`#${modalId} .modal-body`).css({"max-height":"50vh",height:"auto"}),$(`#${modalId} .modal-dialog`).addClass("modal-dialog-centered")}$("body").append(modalTemplate),$(document).on("click",btnSelector,(function(){openModal($(this).data("id"))}));const modalElement=$(`#${modalId}`),submitBtn=modalElement.find(".cw-wizard-submit");modalElement.data("form-submitted",!1),modalElement.on("hide.bs.modal",(async function(e){if(modalElement.data("confirmed-close")||modalElement.data("form-submitted"))return modalElement.data("confirmed-close",!1),!0;e.preventDefault();(await confirmAction("Are you sure you want to exit? Any unsaved changes will be lost.")).isConfirmed&&(modalElement.data("confirmed-close",!0),modalElement.modal("hide"))})),modalElement.on("hidden.bs.modal",(async function(e){!function(){const $modal=$(`#${modalId}`);$modal.find(".cw-wizard-next, .cw-wizard-prev, .cw-wizard-submit").off(),$modal.find(".cw-wizard-steps .nav-link").off(),$modal.find("input, select, textarea").off("input change blur"),$(document).off("click",btnSelector),$modal.off(),$modal.find("form").off(),$modal.removeData();try{const modalInstance=bootstrap.Modal.getInstance($modal[0]);modalInstance&&modalInstance.dispose()}catch(e){console.error("Error disposing modal:",e)}$modal.remove(),modalId=null}(),modalElement.data("form-submitted",!1)})),modalElement.find("form").on("submit",(async function(e){e.preventDefault();const form=this;if(form.isSubmitting)return!1;form.isSubmitting=!0;const formData=new FormData(form),url=$(this).attr("action");setButtonLoading(submitBtn,!0);try{await fetchRequest(url,"POST",formData)?(setButtonLoading(submitBtn,!1),modalElement.data("form-submitted",!0),modalElement.modal("hide"),"function"==typeof formSubmitted&&formSubmitted()):document.querySelector("#error-indicator").innerHTML='\n                    <div class="alert alert-danger alert-dismissible fade show text-center" role="alert" style="position: relative; max-width: 600px; margin: 7px auto; border-radius: 3px; box-shadow: 0 4px 8px rgba(0,0,0,0.1);">\n                        Oops! Some fields need your attention. Please review and try again.\n                        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close" style="position: absolute; right: 5px;"></button>\n                    </div>\n                    '}catch(error){setButtonLoading(submitBtn,!1)}finally{form.isSubmitting=!1,setButtonLoading(submitBtn,!1),submitBtn.prop("disabled",!1),submitBtn.text(actionButtonName)}})),modalId.length&&resolve(modalId)}))}document.addEventListener("DOMContentLoaded",(e=>{var forms=document.querySelectorAll(".needs-validation");Array.prototype.slice.call(forms).forEach((function(form){form.addEventListener("submit",(function(event){form.checkValidity()?setButtonLoading(form.querySelector('button[type="submit"], input[type="submit"]')):(event.preventDefault(),event.stopPropagation()),form.classList.add("was-validated")}),!1)}))}));