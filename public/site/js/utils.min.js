async function fetchRequest(url,method="GET",data={},successMessage="Operation successful",errorMessage="There was an error processing your request"){try{let headers={"X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').getAttribute("content"),Accept:"application/json"};data instanceof FormData||(headers["Content-Type"]="application/json");const options={method:method,headers:headers,body:null};"GET"!==method&&(options.body=data instanceof FormData?data:JSON.stringify(data));const response=await fetch(url,options);if(!response.ok){if(422===response.status){return handleValidationErrors((await response.json()).errors),!1}throw new Error(`HTTP error! Status: ${response.status}`)}const result=await response.json();return result.success?"GET"===method?result.data:(alert(result.success||successMessage),!0):(alert(result.error||errorMessage||"An unexpected error occurred","error"),!1)}catch(error){return alert(errorMessage||"There was an error processing your request","error"),!1}}function handleValidationErrors(errors){$(".form-error").remove(),setButtonLoading($('button[type="submit"]'),!1);for(const field in errors){const errorMessages=errors[field],input=$(`[name="${field}"]`);errorMessages.forEach((message=>{const errorElement=`<span class="form-error text-danger">${message}</span>`;input.after(errorElement)}))}}function setButtonLoading(buttonSelector,isLoading=!0,loadingText="Please wait..."){if(!buttonSelector)return;const button=$(buttonSelector);if(!button.length)return;const formElement=button.closest("form"),originalText=button.val()||button.html();isLoading?(formElement.length&&formElement.addClass("disabled-form"),button.data("original-text",originalText),document.documentElement.classList.add("card-loading"),button.is("button")?button.html(`\n                <span class="spinner-border spinner-border-sm" aria-hidden="true"></span>\n                <span role="status">${loadingText}</span>\n            `):button.is("input")&&button.val(loadingText),button.prop("disabled",!0)):(formElement.length&&formElement.removeClass("disabled-form"),document.documentElement.classList.remove("card-loading"),button.is("button")?button.html(button.data("original-text")):button.is("input")&&button.val(button.data("original-text")),button.prop("disabled",!1))}function uniqId(amount){const chars="abcdefghijklmnopqrstuvwxyz0123456789";let uniqueID="";for(let i=0;i<amount;i++){uniqueID+=chars[Math.floor(36*Math.random())]}return uniqueID}function imageCropper(options){var defaults={fileInput:"#image",inputLabelPreview:"#image-label-preview",aspectRatio:1,viewMode:2,imageType:"image/jpeg",quality:.7,onComplete:null};options=$.extend({},defaults,options);var uniqueId=uniqId(6),modalId=`#crop-modal-${uniqueId}`,cropBoxImageId=`#cropbox-image-${uniqueId}`,cropButtonId=`#apply-crop-${uniqueId}`,aspectRatioSelectId="#aspect-ratio-select",actionsContainerId=`#action-buttons-${uniqueId}`;$("body").append(generateModalHtml(uniqueId));var $fileInput=$(options.fileInput),$inputLabelPreview=$(options.inputLabelPreview),$cropBoxImage=$(cropBoxImageId),$cropModal=$(modalId),$aspectRatioSelect=$(aspectRatioSelectId),$cropButton=$(cropButtonId),$actionsContainer=$(actionsContainerId),cropper;function loadActionButtons($container){var buttonsHTML='\n        <select id="aspect-ratio-select" class="select-aspect-ratio form-control">\n            <option value="">Choose Size</option>\n            <option value="1 / 1">1:1 (Square)</option>\n            <option value="16 / 9">16:9 (Widescreen)</option>\n            <option value="9 / 16">9:16 (Vertical)</option>\n            <option value="21 / 9">21:9 (Ultra-wide)</option>\n            <option value="4 / 3">4:3 (Old TV)</option>\n            <option value="3 / 2">3:2 (DSLR)</option>\n            <option value="1 / 1.294">1:1.294 (Letter)</option>\n            <option value="1 / 1.6471">1:1.6471 (Legal)</option>\n            <option value="NaN">Free (Whatever you want)</option>\n        </select>\n        <button type="button" class="btn-mode-move btn btn-light btn-sm" data-method="setDragMode" data-option="move" title="Move">\n            <span class="docs-tooltip" data-toggle="tooltip" title="cropper.setDragMode(&quot;move&quot;)">\n                <span class="text-xs bi-arrows-move"></span>\n            </span>\n        </button>\n        <button type="button" class="btn-mode-crop btn btn-light btn-sm" data-method="setDragMode" data-option="crop" title="Crop">\n            <span class="docs-tooltip" data-toggle="tooltip" title="cropper.setDragMode(&quot;crop&quot;)">\n                <span class="text-xs bi-crop"></span>\n            </span>\n        </button>\n        <button type="button" class="btn-zoom-in btn btn-light btn-sm" data-method="zoom" data-option="0.1" title="Zoom In">\n            <span class="docs-tooltip" data-toggle="tooltip" title="cropper.zoom(0.1)">\n                <i class="bi bi-zoom-in"></i>\n            </span>\n        </button>\n        <button type="button" class="btn-zoom-out btn btn-light btn-sm" data-method="zoom" data-option="-0.1" title="Zoom Out">\n            <span class="docs-tooltip" data-toggle="tooltip" title="cropper.zoom(-0.1)">\n                <i class="bi bi-zoom-out"></i>\n            </span>\n        </button>\n        <button type="button" class="btn-arrow-left btn btn-light btn-sm" data-method="move" data-option="-10" data-second-option="0" title="Move Left">\n            <span class="docs-tooltip" data-toggle="tooltip" title="cropper.move(-10, 0)">\n                <span class="text-xs bi-arrow-left"></span>\n            </span>\n        </button>\n        <button type="button" class="btn-arrow-right btn btn-light btn-sm" data-method="move" data-option="10" data-second-option="0" title="Move Right">\n            <span class="docs-tooltip" data-toggle="tooltip" title="cropper.move(10, 0)">\n                <span class="text-xs bi-arrow-right"></span>\n            </span>\n        </button>\n        <button type="button" class="btn-arrow-up btn btn-light btn-sm" data-method="move" data-option="0" data-second-option="-10" title="Move Up">\n            <span class="docs-tooltip" data-toggle="tooltip" title="cropper.move(0, -10)">\n                <span class="text-xs bi-arrow-up"></span>\n            </span>\n        </button>\n        <button type="button" class="btn-arrow-down btn btn-light btn-sm" data-method="move" data-option="0" data-second-option="10" title="Move Down">\n            <span class="docs-tooltip" data-toggle="tooltip" title="cropper.move(0, 10)">\n                <span class="text-xs bi-arrow-down"></span>\n            </span>\n        </button>\n        <button type="button" class="btn-flip-vr btn btn-light btn-sm" data-method="scaleX" data-option="-1" title="Flip Horizontal">\n            <span class="docs-tooltip" data-toggle="tooltip" title="cropper.scaleX(-1)">\n                <i class="bi-vr"></i>\n            </span>\n        </button>\n        <button type="button" class="btn-flip-hr btn btn-light btn-sm" data-method="scaleY" data-option="-1" title="Flip Vertical">\n            <span class="docs-tooltip" data-toggle="tooltip" title="cropper.scaleY(-1)">\n                <i class="bi-hr"></i>\n            </span>\n        </button>\n        <button type="button" class="btn-add-crop btn btn-light btn-sm" data-method="crop" title="Crop">\n            <span class="docs-tooltip" data-toggle="tooltip" title="cropper.crop()">\n                <span class="text-xs bi-check-lg"></span>\n            </span>\n        </button>\n        <button type="button" class="btn-remove-crop btn btn-light btn-sm" data-method="clear" title="Clear">\n            <span class="docs-tooltip" data-toggle="tooltip" title="cropper.clear()">\n                <i class="bi-x"></i>\n            </span>\n        </button>\n        <button type="button" class="btn-lock btn btn-light btn-sm" data-method="disable" title="Disable">\n            <span class="docs-tooltip" data-toggle="tooltip" title="cropper.disable()">\n                <span class="text-xs bi-lock"></span>\n            </span>\n        </button>\n        <button type="button" class="btn-unlock btn btn-light btn-sm" data-method="enable" title="Enable">\n            <span class="docs-tooltip" data-toggle="tooltip" title="cropper.enable()">\n                <span class="text-xs bi-unlock"></span>\n            </span>\n        </button>\n    ';$container.html(buttonsHTML),$container.find("#aspect-ratio-select").on("change",(function(){var aspectRatio=eval($(this).val());cropper&&cropper.setAspectRatio(aspectRatio)}))}function generateModalHtml(uniqueId){return`\n        <div class="modal modal fade" id="crop-modal-${uniqueId}" tabindex="-1" role="dialog" aria-labelledby="modalLabel" aria-hidden="true">\n            <div class="modal-dialog" role="document">\n                <div class="modal-content">\n                    <div class="modal-header">\n                        <h5 class="modal-title" id="modalLabel">Crop the image</h5>\n                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>\n                    </div>\n                    <div class="modal-body">\n                        <div class="img-container">\n                            <img id="cropbox-image-${uniqueId}" style="display:block; max-height:300px; max-width:100%">\n                        </div>\n                        <div id="action-buttons-${uniqueId}"></div>\n                    </div>\n                    <div class="modal-footer">\n                        <button type="button" class="btn btn-outline-secondary btn-sm" data-bs-dismiss="modal">Cancel</button>\n                        <button type="button" class="btn btn-primary btn-sm" id="apply-crop-${uniqueId}">Crop</button>\n                    </div>\n                </div>\n            </div>\n        </div>\n        `}$fileInput.on("change",(function(e){var files=e.target.files;if(0!==files.length&&files[0].type.startsWith("image/")){var reader,file,done=function(url){$cropBoxImage.attr("src",url),$cropModal.modal({backdrop:"static",keyboard:!1}),$cropModal.modal("show")};files&&files.length>0&&(file=files[0],URL?done(URL.createObjectURL(file)):FileReader&&((reader=new FileReader).onload=function(e){done(reader.result)},reader.readAsDataURL(file))),$cropButton.data("input",this),$cropButton.data("preview",$inputLabelPreview)}else options.onComplete(files[0],this)})),$cropModal.on("click",(function(e){$(e.target).is($cropModal)&&($cropModal.addClass("shake"),setTimeout((function(){$cropModal.removeClass("shake")}),500))})),$cropModal.on("shown.bs.modal",(function(){var selectedAspectRatio=parseFloat($aspectRatioSelect.val())||options.aspectRatio;cropper=new Cropper($cropBoxImage[0],{aspectRatio:selectedAspectRatio,viewMode:options.viewMode,ready:function(){$actionsContainer&&loadActionButtons($actionsContainer)}})})).on("hidden.bs.modal",(function(){cropper&&(cropper.destroy(),cropper=null)})),$cropButton.on("click",(function(){var canvas;if($cropModal.modal("hide"),cropper){canvas=cropper.getCroppedCanvas(),$(this).data("preview").attr("src",canvas.toDataURL(options.imageType,options.quality));var $fileInput=$(this).data("input");canvas.toBlob((function(blob){var file=new File([blob],`cropped-${uniqId(6)}.jpg`,{type:options.imageType});"function"==typeof options.onComplete&&options.onComplete(file,$fileInput);var dataTransfer=new DataTransfer;dataTransfer.items.add(file),$fileInput.files=dataTransfer.files}),options.imageType,options.quality)}})),$actionsContainer.on("click",(function(event){var target=event.target;if(cropper){for(;target!==this&&!target.getAttribute("data-method");)target=target.parentNode;if(!(target===this||target.disabled||target.className.indexOf("disabled")>-1)){var data={method:target.getAttribute("data-method"),option:target.getAttribute("data-option"),secondOption:target.getAttribute("data-second-option")};data.method&&(cropper[data.method](data.option,data.secondOption),"scaleX"!==data.method&&"scaleY"!==data.method||target.setAttribute("data-option",-data.option))}}}))}function pushStateModal({title:title="Title",fetchUrl:fetchUrl,btnSelector:btnSelector,loadingSpinner:loadingSpinner="loading-spinner",actionButtonName:actionButtonName,modalSize:modalSize="md",modalType:modalType,includeForm:includeForm=!1,formAction:formAction,modalHeight:modalHeight="70vh"}){return new Promise((resolve=>{const calcModalType=modalType??btnSelector.replace(/^[.#]/,"").split("-")[0],modalId=`modal-${calcModalType}`,modalContentClass=`detail-${calcModalType}`,actionBtnId=actionButtonName&&actionButtonName.replace(/\s+/g,"-").toLowerCase()+"-"+calcModalType,modalTemplate=`\n        <div class="modal fade" id="${modalId}" tabindex="-1" aria-hidden="true">\n            <div class="modal-dialog modal-${modalSize} modal-dialog-centered modal-dialog-scrollable">\n                \n                <div class="modal-content">\n                    <div class="modal-header">\n                        <h5 class="modal-title">${title}</h5>\n                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>\n                    </div>\n                    ${includeForm?`<form id="form-${calcModalType}" method="POST" enctype="multipart/form-data">`:""}\n                    <div class="modal-body" style="${includeForm&&"height:"+modalHeight}">\n                        <div class="${loadingSpinner} text-center mt-2">\n                            <div class="spinner-border" role="status">\n                                <span class="visually-hidden">Loading...</span>\n                            </div>\n                        </div>\n                        <div class="${modalContentClass} p-1"></div>\n                    </div>\n                    <div class="modal-footer">\n                        <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal" aria-label="Closse">Cancel</button>\n                        ${actionButtonName?`<button type="submit" id="${actionBtnId}" class="btn btn-primary px-3">${actionButtonName}</button>`:""}    \n                    </div>\n                    ${includeForm?"</form>":""}\n                </div>\n                \n            </div>\n        </div>`;async function openModal(recordId){const url=fetchUrl.replace(":id",recordId);includeForm&&$(`#form-${calcModalType}`).attr("action",formAction.replace(":id",recordId)),$(`#${modalId}`).modal("show"),$(`#${modalId} .${loadingSpinner}`).show(),$(`#${modalId} .${modalContentClass}`).hide();const result=(await fetchRequest(url)).result;result?($(`#${modalId} .modal-title`).text(title),$(`#${modalId} .${modalContentClass}`).html(result)):($(`#${modalId} .modal-title`).text("Error"),$(`#${modalId} .${modalContentClass}`).html('<p class="pb-0 pt-3 p-4">Unable to load content.</p>')),$(`#${modalId} .${loadingSpinner}`).hide(),$(`#${modalId} .${modalContentClass}`).show()}function openModalFromUrl(){const urlParams=new URLSearchParams(window.location.search),recordId=urlParams.get("id"),type=urlParams.get("type");recordId&&type===calcModalType&&openModal(recordId)}$(`#${modalId}`).length||$("body").append(modalTemplate),$(document).on("click",btnSelector,(function(){const recordId=$(this).data("id"),newUrl=`${new URL(window.location).pathname}?id=${recordId}&type=${calcModalType}${window.location.hash}`;history.pushState(null,null,newUrl),openModal(recordId)})),$(window).on("popstate",(function(){openModalFromUrl()})),$(`#${modalId}`).on("hidden.bs.modal",(function(){const currentUrl=new URL(window.location);currentUrl.searchParams.delete("id"),currentUrl.searchParams.delete("type");const newUrl=`${currentUrl.pathname}${currentUrl.search}${window.location.hash}`;history.pushState(null,null,newUrl)})),openModalFromUrl(),modalId.length&&resolve(modalId)}))}